name: Auto commit job

on:
    repository_dispatch:
        types: [ promote ]

jobs:
    Bump:
        name: Bump package version & commit
        runs-on: ubuntu-latest

        strategy:
            matrix:
                node-version: [ 14.x ]
                branch: [ main ]

        steps:
            -   uses: actions/checkout@v3
                with:
                    ref: ${{ matrix.branch }}
                    token: ${{ secrets.AUTH_TOKEN }}
                    cache: 'yarn'

            -   run: echo "Automatic version bump ${{ github.event.client_payload.LIBRARY }}@${{ github.event.client_payload.VERSION }}" >> ./test.txt
            -   run: echo "Automatic version bump ${{ github.event.client_payload.LIBRARY }}@${{ github.event.client_payload.VERSION }}" >> ./test.lock

            -   uses: stefanzweifel/git-auto-commit-action@v4
                if: ${{ (github.event.client_payload.FORCERC == 'true' || !contains(steps.version.outputs.tag, '-rc.')) && github.event.client_payload.VERSION != steps.version.outputs.tag }}
                with:
                    commit_message: Automatic version bump ${{ github.event.client_payload.LIBRARY }}@${{ github.event.client_payload.VERSION }}
                    file_pattern: './*.txt'
